<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Insta Reel ‚Äî Storyboard (GSAP-enhanced)</title>
  <style>
    :root{--gold:#ffd166;--accent:#ff9a66;--muted:#9aa4b2}
    body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;color:#fff;background:#0b0d10}
    .canvas-wrap{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box}
    .reel{width:360px;height:640px;background:linear-gradient(180deg,#111215,#15181c);border-radius:22px;overflow:hidden;position:relative;box-shadow:0 24px 60px rgba(0,0,0,0.6);cursor:pointer}

    .timeline{position:absolute;top:12px;left:12px;right:12px;height:6px;border-radius:99px;z-index:60}
    .timeline .track{height:100%;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
    .timeline .progress{height:100%;width:0;background:linear-gradient(90deg,var(--gold),var(--accent));}

    main.stage{position:absolute;inset:0;padding:28px;display:block}
    .scene{position:absolute;inset:28px;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;text-align:center;opacity:0;transform:translateY(28px) scale(.996);transition:opacity .35s ease, transform .45s cubic-bezier(.2,.9,.2,1);pointer-events:none}
    .scene.active{opacity:1;transform:none;pointer-events:auto}

    h2.headline{font-size:22px;font-weight:800;line-height:1.05;margin:0}
    p.sub{color:var(--muted);font-size:14px;margin:0}
    p.caption{background:rgba(255,255,255,0.02);padding:10px 14px;border-radius:12px;color:#fff;max-width:92%;margin:0}

    .graphic{width:180px;height:180px;display:grid;place-items:center;position:relative}
    svg{width:100%;height:100%}

    /* reduce-motion fallback via media-query */
    @media (prefers-reduced-motion: reduce){
      .scene{transition:none!important}
      .graphic{animation:none!important}
    }

    /* minor visual helpers (kept minimal since GSAP will drive the real motion) */
    .coin{width:64px;height:64px;border-radius:50%;display:grid;place-items:center;font-weight:800;background:linear-gradient(180deg,#ffd166,#f9a825);color:#4b2b00;box-shadow:0 10px 30px rgba(0,0,0,0.45);}
    .big-no{font-size:78px;font-weight:900;color:#ff6b6b;margin:0}
    .final{padding:14px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));}

    /* debug overlay */
    #errorOverlay{position:absolute;left:12px;right:12px;bottom:12px;z-index:99;display:none}
    #errorBox{background:rgba(255,16,16,0.12);border-radius:8px;padding:10px 12px;color:#fff;font-size:12px;backdrop-filter:blur(6px);max-height:140px;overflow:auto}
  </style>
</head>
<body>
  <div class="canvas-wrap">
    <article class="reel" id="reel" aria-hidden="false">
      <div class="timeline"><div class="track"><div class="progress" id="progress"></div></div></div>
      <main class="stage" role="main">

        <!-- Scenes (semantic tags) -->
        <section class="scene active" data-i="0">
          <div class="graphic" aria-hidden="true">
            <svg viewBox="0 0 64 64" role="img" aria-label="megaphone"><polygon points="10,24 36,12 36,52 10,40" fill="var(--gold)"/><rect x="36" y="20" width="16" height="24" fill="var(--accent)"/></svg>
          </div>
          <h2 class="headline">Boosting posts but getting no results?</h2>
          <p class="sub">A jewellery brand was stuck in this loop.</p>
        </section>

        <section class="scene" data-i="1">
          <div class="graphic" aria-hidden="true">
            <svg viewBox="0 0 200 200" role="img" aria-label="gem"><polygon points="100,10 190,80 150,190 50,190 10,80" fill="#ffd166" stroke="#fff" stroke-width="4"/></svg>
            <div class="spark" style="left:20%;top:20%"></div>
            <div class="spark" style="left:70%;top:40%"></div>
          </div>
          <p class="caption">The founder asked, ‚ÄúIs this normal for every brand?‚Äù</p>
        </section>

        <section class="scene" data-i="2">
          <div style="display:flex;align-items:center;gap:12px;justify-content:center">
            <div class="coin" data-i="0">‚Çπ30</div>
            <span aria-hidden style="font-size:28px">‚Üí</span>
            <div class="coin" data-i="2">‚Çπ50</div>
          </div>
          <p class="caption">They spent ‚Çπ30 and made only ‚Çπ50 in sales.</p>
        </section>

        <section class="scene" data-i="3">
          <div class="graphic" aria-hidden="true">
            <svg viewBox="0 0 120 120"><circle cx="60" cy="60" r="50" stroke="#ff6b6b" stroke-width="6" fill="none"/><line x1="40" y1="40" x2="80" y2="80" stroke="#ff6b6b" stroke-width="6"/><line x1="80" y1="40" x2="40" y2="80" stroke="#ff6b6b" stroke-width="6"/></svg>
          </div>
          <p class="caption">On days with no spend, sales dropped to zero.</p>
        </section>

        <section class="scene" data-i="4">
          <h2 class="big-no">NO</h2>
          <p class="sub">Boosting isn‚Äôt the only way.</p>
        </section>

        <section class="scene" data-i="5">
          <div class="graphic" aria-hidden="true">
            <svg viewBox="0 0 120 120"><circle cx="40" cy="50" r="20" fill="var(--gold)"/><circle cx="80" cy="50" r="20" fill="var(--accent)"/></svg>
          </div>
          <p class="caption">üëâ Built a custom audience from engaged users.</p>
        </section>

        <section class="scene" data-i="6">
          <div class="graphic" aria-hidden="true">
            <svg viewBox="0 0 160 120"><rect x="20" y="20" width="120" height="80" rx="10" fill="#1e1e22" stroke="#333"/><rect x="30" y="30" width="50" height="50" fill="var(--gold)"/><rect x="90" y="40" width="60" height="20" fill="#fff" opacity="0.2"/></svg>
          </div>
          <p class="caption">üëâ Ran conversion-focused ads with clear offers.</p>
        </section>

        <section class="scene" data-i="7">
          <div class="graphic" aria-hidden="true">
            <svg viewBox="0 0 140 120"><circle cx="70" cy="60" r="40" fill="#111" stroke="#444"/><path d="M70 20 A40 40 0 1 1 69 20" class="retarget-arrow"/></svg>
          </div>
          <p class="caption">üëâ Retargeted browsers who didn‚Äôt buy.</p>
        </section>

        <section class="scene" data-i="8">
          <div class="graphic" aria-hidden="true">
            <svg viewBox="0 0 200 120" class="chart"><path d="M10 100 C50 60 100 80 150 40 180 20 200 30 200 20" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <h2 class="headline">The result?</h2>
          <p class="caption">Steady, daily sales without boost-or-bust stress.</p>
        </section>

        <section class="scene" data-i="9">
          <div class="final">
            <h2 class="headline">Takeaway</h2>
            <p class="sub">Use boosts to warm people up, then a real ad strategy to sell.</p>
          </div>
          <div class="confetti">
            <div class="c" style="left:10%;background:#ffd166"></div>
            <div class="c" style="left:40%;background:#ff9a66"></div>
            <div class="c" style="left:70%;background:#9ad6ff"></div>
          </div>
        </section>

      </main>

      <div id="errorOverlay"><div id="errorBox">JS errors will appear here</div></div>
    </article>
  </div>

  <!-- Load GSAP (graceful fallback if blocked) -->
  <script>
    (function(){
      var s = document.createElement('script');
      s.src = 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js';
      s.crossOrigin = 'anonymous';
      s.onload = function(){ window._GSAP_LOADED = true };
      s.onerror = function(){ window._GSAP_LOADED = false };
      document.head.appendChild(s);
    })();
  </script>

  <script>
    // Core timeline logic with GSAP if available; otherwise fallback to simple timer-based playback
    (function(){
      const scenes = Array.from(document.querySelectorAll('.scene'));
      const durations = [3,3,3,2,2,3,3,3,3,4];
      const total = durations.reduce((a,b)=>a+b,0);
      const progress = document.getElementById('progress');
      const reel = document.getElementById('reel');
      const errorBox = document.getElementById('errorBox');
      let masterTimeline = null;
      let fallbackTimers = [];

      function showScene(i){
        scenes.forEach((s,idx)=> s.classList.toggle('active', idx===i));
      }

      function setupGSAP(){
        try{
          if(!window.gsap) return false;
          // kill any previous timeline
          if(masterTimeline){ masterTimeline.kill(); masterTimeline = null; }

          const gs = window.gsap;
          masterTimeline = gs.timeline({repeat:-1, paused:false});

          let acc=0;
          for(let i=0;i<scenes.length;i++){
            const scene = scenes[i];
            const dur = durations[i];
            const startPct = (acc/total)*100;
            const endPct = ((acc+dur)/total)*100;

            // when entering scene: show, then animate visuals concurrently
            masterTimeline.add(()=>{
              // clear tweens of elements to avoid overlap
              gs.killTweensOf(scene.querySelectorAll('*'));
              showScene(i);
              // scene-specific animations
              if(i===2){ // coins
                const coins = scene.querySelectorAll('.coin');
                gs.fromTo(coins, {y:-60, scale:0.7, opacity:0}, {y:0, scale:1, opacity:1, stagger:0.12, duration:0.6, ease:'bounce.out'});
              }
              if(i===1){ // gem sparkles
                const sparks = scene.querySelectorAll('.spark');
                gs.to(sparks, {scale:1.2, opacity:1, repeat:-1, yoyo:true, stagger:0.3, duration:1.2, ease:'sine.inOut'});
              }
              if(i===8){ // chart draw
                const path = scene.querySelector('.chart path');
                if(path){
                  const len = path.getTotalLength();
                  path.style.stroke = getComputedStyle(document.documentElement).getPropertyValue('--gold') || '#ffd166';
                  path.style.strokeWidth = 3;
                  path.style.fill = 'none';
                  path.style.strokeDasharray = len;
                  path.style.strokeDashoffset = len;
                  gs.to(path, {strokeDashoffset:0, duration:Math.min(2, dur-0.2), ease:'power2.out'});
                }
              }
              if(i===7){ // retarget rotate
                const arrow = scene.querySelector('.retarget-arrow');
                if(arrow) gs.to(arrow, {rotation:360, transformOrigin:'50% 50%', repeat:-1, duration:2, ease:'linear'});
              }
              if(i===4){ // big NO shock
                const bigno = scene.querySelector('.big-no') || scene.querySelector('.headline');
                if(bigno) gs.fromTo(bigno, {scale:0.9, rotation:-6, opacity:0}, {scale:1, rotation:0, opacity:1, duration:0.6, ease:'back.out(1.4)'});
              }
              if(i===9){ // confetti
                const confs = scene.querySelectorAll('.confetti .c');
                confs.forEach((c,idx)=>{
                  gs.fromTo(c, {y:-10, opacity:0}, {y:240, rotation:360, opacity:1, delay:idx*0.08, duration:1.6, ease:'power1.out'});
                });
              }
            }, '+=0');

            // progress animation over this scene duration
            masterTimeline.to(progress, {width: endPct + '%', duration: dur, ease: 'linear'}, '>-0');

            // small pause (none) then continue
            acc += dur;
          }

          return true;
        }catch(err){
          console.error('GSAP setup failed', err);
          if(errorBox) errorBox.textContent = 'GSAP Error: ' + (err && err.message ? err.message : String(err)); document.getElementById('errorOverlay').style.display='block';
          return false;
        }
      }

      function startFallback(from=0){
        // simple timer-based playback if GSAP not available
        clearFallback();
        let acc = 0;
        for(let i=from;i<scenes.length;i++){
          const idx = i;
          fallbackTimers.push(setTimeout(()=> showScene(idx), acc*1000));
          // animate progress step (jump) to end of scene so it's visible
          fallbackTimers.push(setTimeout(()=>{ progress.style.width = ((acc+durations[idx])/total*100) + '%'; }, acc*1000));
          acc += durations[idx];
        }
        fallbackTimers.push(setTimeout(()=> startFallback(0), acc*1000));
      }

      function clearFallback(){ fallbackTimers.forEach(t=>clearTimeout(t)); fallbackTimers=[]; }

      // initialization: wait a small time for GSAP script to load (if allowed)
      function init(){
        // reduced-motion respect
        const reduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if(reduced){ // show scenes with no motion
          showScene(0);
          startFallback(0);
          return;
        }

        // try to setup GSAP if available
        if(window.gsap){
          const ok = setupGSAP();
          if(ok) return; // done
        }

        // if gsap not yet loaded, poll for a short window (1.5s) then fallback
        let waited = 0;
        const poll = setInterval(()=>{
          waited += 100;
          if(window.gsap){ clearInterval(poll); const ok = setupGSAP(); if(!ok) startFallback(0); }
          if(waited > 1500){ clearInterval(poll); startFallback(0); }
        }, 100);
      }

      // click to go to next scene immediately
      reel.addEventListener('click', ()=>{
        try{
          if(window.gsap && masterTimeline){
            masterTimeline.pause();
            const next = (scenes.findIndex(s=>s.classList.contains('active')) + 1) % scenes.length;
            showScene(next);
            // reset progress bar to correct percent
            const elapsed = durations.slice(0,next).reduce((a,b)=>a+b,0);
            progress.style.width = (elapsed/total*100) + '%';
            // resume timeline after short delay
            setTimeout(()=> masterTimeline.play(), 700);
          }else{
            // fallback: clear timers and show next
            clearFallback();
            const cur = scenes.findIndex(s=>s.classList.contains('active'));
            const next = (cur + 1) % scenes.length;
            showScene(next);
            // resume fallback after a small pause
            setTimeout(()=> startFallback((next+1)%scenes.length), 700);
          }
        }catch(err){ console.error(err); }
      });

      // error overlay handlers
      window.addEventListener('error', e=>{ if(errorBox){ errorBox.textContent = 'JS Error: ' + (e && e.message ? e.message : String(e)); document.getElementById('errorOverlay').style.display='block'; } });
      window.addEventListener('unhandledrejection', ev=>{ if(errorBox){ errorBox.textContent = 'Promise Rejection: ' + (ev.reason && ev.reason.message ? ev.reason.message : JSON.stringify(ev.reason)); document.getElementById('errorOverlay').style.display='block'; } });

      // start
      window.addEventListener('load', ()=>{
        try{ init(); }catch(err){ console.error(err); startFallback(0); }
      });

    })();
  </script>
</body>
</html>
